import{d as T,r as y,o as G,a as m,c as w,b as M,e as r,w as u,f as c,g as F,u as W,h as H,i as _,t as v,E as U,j as J,k as Q,l as X,m as Y}from"./vendor-CY0dUq6q.js";import{a as R}from"./utils-NIGUFBhG.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&p(h)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function p(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const Z="/api/files",B=R.create({baseURL:Z,timeout:3e4,headers:{"Content-Type":"application/json"}});B.interceptors.request.use(e=>{var o;return console.log("API Request:",(o=e.method)==null?void 0:o.toUpperCase(),e.url),e},e=>(console.error("API Request Error:",e),Promise.reject(e)));B.interceptors.response.use(e=>(console.log("API Response:",e.status,e.data),e),e=>{var o;return console.error("API Response Error:",((o=e.response)==null?void 0:o.data)||e.message),Promise.reject(e)});const x={async getUploadUrl(e){return(await B.post("/upload-url",e)).data},async confirmUpload(e){return(await B.post("/confirm-upload",e)).data},async deleteFile(e){return(await B.delete(`/${e}`)).data},async healthCheck(){return(await B.get("/health")).data},async uploadFileToMinio(e,o,t){await R.put(e,o,{headers:{"Content-Type":o.type},timeout:6e5,onUploadProgress:p=>{if(p.total&&t){const a=Math.round(p.loaded*100/p.total);t(a)}}})}},ee={class:"file-upload-container"},te={class:"card-header"},ae={class:"upload-area"},se={key:0,class:"file-info"},oe={class:"upload-actions"},le={key:1,class:"upload-progress"},ne={class:"progress-info"},re={class:"progress-text"},ue={class:"progress-stats"},ce={key:0,class:"upload-speed"},ie={class:"progress-percentage"},de={key:2,class:"upload-result"},pe={key:0,class:"result-details"},fe={class:"result-actions"},_e=T({__name:"FileUpload",setup(e){const o=y(),t=y(null),p=y(!1),a=y(0),n=y(""),h=y(""),C=y("UNKNOWN"),i=y(null),A=async()=>{try{const l=await x.healthCheck();C.value=l.status}catch(l){C.value="DOWN",console.error("健康检查失败:",l)}},L=l=>{t.value=l.raw,i.value=null},j=l=>l.size>104857600?(U.error("文件大小不能超过 100MB"),!1):!0,D=()=>{t.value=null,i.value=null,a.value=0,n.value="",h.value="",o.value&&o.value.clearFiles()},E=l=>{if(l===0)return"0 Bytes";const s=1024,d=["Bytes","KB","MB","GB"],f=Math.floor(Math.log(l)/Math.log(s));return parseFloat((l/Math.pow(s,f)).toFixed(2))+" "+d[f]},K=l=>{if(l===0)return"0 B/s";const s=1024,d=["B/s","KB/s","MB/s","GB/s"],f=Math.floor(Math.log(l)/Math.log(s));return parseFloat((l/Math.pow(s,f)).toFixed(2))+" "+d[f]},V=l=>new Date(l).toLocaleString("zh-CN"),$=async()=>{var l,s;if(!t.value){U.warning("请先选择文件");return}p.value=!0,a.value=0,n.value="正在获取上传链接...",h.value="",i.value=null;try{a.value=0,n.value="获取上传链接...";const d=await x.getUploadUrl({fileName:t.value.name,contentType:t.value.type,fileSize:t.value.size});a.value=0,n.value="正在上传文件到MinIO...";let f=Date.now(),z=0;await x.uploadFileToMinio(d.uploadUrl,t.value,k=>{a.value=k,n.value="正在上传文件到MinIO...";const b=Date.now(),N=(b-f)/1e3,O=k/100*t.value.size,S=O-z;if(N>0&&S>0){const I=S/N;h.value=K(I)}f=b,z=O}),n.value="确认上传完成...";const g=await x.confirmUpload({objectKey:d.objectKey,fileName:t.value.name,contentType:t.value.type,fileSize:t.value.size});a.value=100,n.value="上传完成！",i.value={success:!0,message:"文件上传成功！",data:g},U.success("文件上传成功！")}catch(d){console.error("上传失败:",d),a.value=0,n.value="上传失败",i.value={success:!1,message:((s=(l=d.response)==null?void 0:l.data)==null?void 0:s.message)||d.message||"上传失败"},U.error("文件上传失败: "+i.value.message)}finally{p.value=!1}},q=async l=>{var s,d;try{await J.confirm("确定要删除这个文件吗？此操作不可恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.deleteFile(l),U.success("文件删除成功"),i.value=null}catch(f){f!=="cancel"&&U.error("删除文件失败: "+(((d=(s=f.response)==null?void 0:s.data)==null?void 0:d.message)||f.message))}};return G(()=>{A()}),(l,s)=>{const d=m("el-tag"),f=m("el-icon"),z=m("el-upload"),g=m("el-descriptions-item"),k=m("el-descriptions"),b=m("el-button"),N=m("el-progress"),O=m("el-alert"),S=m("el-link"),I=m("el-card");return M(),w("div",ee,[r(I,{class:"upload-card"},{header:u(()=>[c("div",te,[s[1]||(s[1]=c("h2",null,"文件上传到 MinIO",-1)),r(d,{type:C.value==="UP"?"success":"danger"},{default:u(()=>[_(v(C.value==="UP"?"服务正常":"服务异常"),1)]),_:1},8,["type"])])]),default:u(()=>[c("div",ae,[r(z,{ref_key:"uploadRef",ref:o,"auto-upload":!1,"show-file-list":!1,"on-change":L,"before-upload":j,drag:"",class:"upload-dragger"},{tip:u(()=>s[2]||(s[2]=[c("div",{class:"el-upload__tip"}," 支持任意类型文件，单个文件最大 100MB ",-1)])),default:u(()=>[r(f,{class:"el-icon--upload"},{default:u(()=>[r(W(H))]),_:1}),s[3]||(s[3]=c("div",{class:"el-upload__text"},[_(" 将文件拖到此处，或"),c("em",null,"点击上传")],-1))]),_:1,__:[3]},512)]),t.value?(M(),w("div",se,[r(k,{column:2,border:""},{default:u(()=>[r(g,{label:"文件名"},{default:u(()=>[_(v(t.value.name),1)]),_:1}),r(g,{label:"文件大小"},{default:u(()=>[_(v(E(t.value.size)),1)]),_:1}),r(g,{label:"文件类型"},{default:u(()=>[_(v(t.value.type||"未知"),1)]),_:1}),r(g,{label:"最后修改"},{default:u(()=>[_(v(V(t.value.lastModified)),1)]),_:1})]),_:1}),c("div",oe,[r(b,{type:"primary",loading:p.value,onClick:$,disabled:!t.value},{default:u(()=>[_(v(p.value?"上传中...":"开始上传"),1)]),_:1},8,["loading","disabled"]),r(b,{onClick:D},{default:u(()=>s[4]||(s[4]=[_("清除文件",-1)])),_:1,__:[4]})])])):F("",!0),p.value?(M(),w("div",le,[r(N,{percentage:a.value,status:a.value===100?"success":"","stroke-width":8,"show-text":!1},null,8,["percentage","status"]),c("div",ne,[c("p",re,v(n.value),1),c("div",ue,[h.value?(M(),w("span",ce,v(h.value),1)):F("",!0),c("span",ie,v(a.value)+"%",1)])])])):F("",!0),i.value?(M(),w("div",de,[r(O,{title:i.value.success?"上传成功":"上传失败",type:i.value.success?"success":"error",description:i.value.message,"show-icon":"",closable:!1},null,8,["title","type","description"]),i.value.success&&i.value.data?(M(),w("div",pe,[r(k,{column:1,border:""},{default:u(()=>[r(g,{label:"对象键"},{default:u(()=>[_(v(i.value.data.objectKey),1)]),_:1}),r(g,{label:"文件URL"},{default:u(()=>[r(S,{href:i.value.data.url,target:"_blank",type:"primary"},{default:u(()=>[_(v(i.value.data.url),1)]),_:1},8,["href"])]),_:1}),r(g,{label:"上传时间"},{default:u(()=>[_(v(i.value.data.uploadTime),1)]),_:1})]),_:1}),c("div",fe,[r(b,{type:"danger",size:"small",onClick:s[0]||(s[0]=we=>q(i.value.data.objectKey))},{default:u(()=>s[5]||(s[5]=[_(" 删除文件 ",-1)])),_:1,__:[5]})])])):F("",!0)])):F("",!0)]),_:1})])}}}),ve=(e,o)=>{const t=e.__vccOpts||e;for(const[p,a]of o)t[p]=a;return t},me=ve(_e,[["__scopeId","data-v-93f41065"]]),he={id:"app"},ge={class:"app-main"},ye=T({__name:"App",setup(e){return(o,t)=>(M(),w("div",he,[t[0]||(t[0]=c("header",{class:"app-header"},[c("div",{class:"header-content"},[c("h1",null,"S3 文件上传演示"),c("p",null,"使用 Vue 3 + Spring Boot + MinIO 构建的文件上传系统")])],-1)),c("main",ge,[r(me)]),t[1]||(t[1]=c("footer",{class:"app-footer"},[c("p",null,"© 2026 S3 文件上传演示项目")],-1))]))}}),P=Q(ye);P.use(X);for(const[e,o]of Object.entries(Y))P.component(e,o);P.mount("#app");
